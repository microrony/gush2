{{ 'section-contact-footer.css' | asset_url | stylesheet_tag }}

{%- if section.settings.page_name != 'group_buy' -%}
  {%- liquid
             assign project_blocks = section.blocks | where: 'type', 'project_block' 
             -%}
{%- endif -%}

{% if section.settings.page_name == 'new_home' %}
  {% style %}
  {% endstyle %}
{% endif %}
<style>
  .contact_error_msg{
    color: red;
  }
</style>

<section class="footer-contact page-width isolate section-{{ section.id }}-bg footer-contact-main">
  <div class="footer-contact__main" id="contact-here">
    <div class="footer-contact__main-text">
      <div class="footer-contact__main-heading">
        <h3 class="new_home_footer_title">{{ section.settings.title }}</h3>
        <h2
          class="
            footer-contact-heading {%- if section.settings.page_name == "group_buy" -%}
              gush-font-h3
              {% else  %}
              gush-font-h2
            {%- endif -%}
          "
        >
          {{ section.settings.heading }}
        </h2>
      </div>
      {% if section.settings.page_name == 'new_home' %}
        <div class="footer-contact__main-para">
          <a href="#">{% render 'icon-arrow-right' %}</a>
        </div>
      {% endif %}
    </div>
    <div class="footer-contact__form">
      {%- form 'contact', id: 'ContactForm', class: 'isolate' -%}
        {%- if form.posted_successfully? -%}
          <div class="form-status form-status-list form__message" tabindex="-1" autofocus>
            {% render 'icon-success' %}
            {{ 'templates.contact.form.post_success' | t }}
          </div>
        {%- elsif form.errors -%}
          <div class="form__message">
            <h2 class="form-status caption-large text-body" role="alert" tabindex="-1" autofocus>
              {% render 'icon-error' %}
              {{ 'templates.contact.form.error_heading' | t }}
            </h2>
          </div>
          <ul class="form-status-list caption-large" role="list">
            <li>
              <a href="#ContactForm-email" class="link">
                {{ form.errors.translated_fields.email | capitalize }}
                {{ form.errors.messages.email }}
              </a>
            </li>
          </ul>
        {%- endif -%}
        <div class="contact__fields">
          <div class="field">
            <input
              class="field__input contact_input_fields"
              autocomplete="name"
              type="text"
              id="ContactForm-name"
              name="contact[{{ 'templates.contact.form.name' | t }}]"
              value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}"
              placeholder="{{ 'templates.contact.form.name' | t }}"
              required
            >
            <label class="field__label" for="ContactForm-name">{{ 'templates.contact.form.name' | t }} <span aria-hidden="true">*</span></label>
          </div>
          <small class="contact_error_msg" id="contact[{{ 'templates.contact.form.name' | t }}]"></small>
          <div class="field field--with-error">
            <input
              autocomplete="email"
              type="email"
              id="ContactForm-email"
              class="field__input contact_input_fields"
              name="contact[email]"
              spellcheck="false"
              autocapitalize="off"
              value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
              aria-required="true"
              {% if form.errors contains 'email' %}
                aria-invalid="true"
                aria-describedby="ContactForm-email-error"
              {% endif %}
              placeholder="{{ 'templates.contact.form.email' | t }}"
              required
            >
            <label class="field__label" for="ContactForm-email">
              {{- 'templates.contact.form.email' | t }}
              <span aria-hidden="true">*</span></label
            >
            {%- if form.errors contains 'email' -%}
              <small class="contact__field-error" id="ContactForm-email-error">
                <span class="visually-hidden">{{ 'accessibility.error' | t }}</span>
                <span class="form__message">
                  {%- render 'icon-error' -%}
                  {{- form.errors.translated_fields.email | capitalize }}
                  {{ form.errors.messages.email -}}
                </span>
              </small>
            {%- endif -%}
          </div>
          <small class="contact_error_msg" id="contact[email]"></small>
        </div>
        <div class="field">
          <input
            type="tel"
            id="ContactForm-phone"
            class="field__input contact_input_fields"
            autocomplete="tel"
            name="contact[{{ 'templates.contact.form.phone' | t }}]"
            pattern="[0-9\-]*"
            value="{% if form.phone %}{{ form.phone }}{% elsif customer %}{{ customer.phone }}{% endif %}"
            placeholder="{{ 'templates.contact.form.phone' | t }}"
            required
          >
          <label class="field__label" for="ContactForm-phone">{{ 'templates.contact.form.phone' | t }} <span aria-hidden="true">*</span></label>
        </div>
        <small class="contact_error_msg" id="contact[{{ 'templates.contact.form.phone' | t }}]"></small>
        <div class="select_box_group_buy">
            <select
              class="select_input_group_buy gray_color contact_input_fields"
              id="ContactForm-discover"
              name="contact[discover]"
              required
            >
              <option disabled selected value>-- select option --</option>
              <option value="search-engines">Search engines (Google, Yahoo, etc.)</option>
              <option value="word-of-mouth">Word of mouth (Friend, Colleague, etc.)</option>
              <option value="blog-or-publication">Blog or publication</option>
              <option value="social-media">Social media</option>
              <option value="other">Other</option>
            </select>
            <br>
            <label class="select_label_group_buy option_discover" for="ContactForm-discover">How did you discover Gush? <span aria-hidden="true">*</span></label>
          </div>
        {%- if section.settings.page_name != 'group_buy' -%}
          <div class="field">
            <textarea
              rows="10"
              id="ContactForm-body"
              class="text-area field__input contact_input_fields"
              name="contact[{{ 'templates.contact.form.comment' | t }}]"
              placeholder="{{ 'templates.contact.form.comment' | t }}"
              required
            >
          {{- form.body -}}
        </textarea>
            <label class="form__label field__label" for="ContactForm-body">
              {{- 'templates.contact.form.comment' | t -}} <span aria-hidden="true"> *</span>
            </label>
          </div>
          <small class="contact_error_msg" id="contact[{{ 'templates.contact.form.comment' | t }}]"></small>
        {% else %}
          <div class="select_box_group_buy">
            <select
              class="select_input_group_buy gray_color contact_input_fields"
              id="ContactForm-project"
              name="contact[project]"
              required
            >
              <option disabled selected value>-- select a project --</option>
              {% for block in section.blocks %}
                <option value="{{ block.settings.projectname}}">{{ block.settings.projectname}}</option>
              {% endfor %}
            </select>
            <br>
            <label class="select_label_group_buy option_project" for="ContactForm-project">Project </label>
          </div>
          <div class="field">
            <textarea
              rows="10"
              id="ContactForm-project_details"
              class="text-area field__input contact_input_fields"
              name="contact[project_details]"
              placeholder="Project details"
              required
            >
          {{- form.project_details -}}
        </textarea>
            <label class="form__label field__label" for="ContactForm-project_details">Project details <span aria-hidden="true">*</span></label>
          </div>
          <small class="contact_error_msg" id="contact[project_details]"></small>
        {%- endif -%}
        <div class="">
          <button
            type="submit"
            class="cta-button gush-font-teritary {% if section.settings.btn_type == "primary"%}cta-button__fuschia{% else %}cta-button__secondary{% endif %}"
          >
            {{ section.settings.btn_text -}}
            {%- render 'arrow-dotted-black' %}
          </button>
        </div>
      {%- endform -%}
    </div>
  </div>
</section>
<script>
  const selectTag = document.getElementById("ContactForm-discover");
  const selectLabel = document.querySelector(".option_discover");
  selectTag.addEventListener("click",(e)=>{
    if(e.target.value){
      selectLabel.style.fontSize = "10px";
      selectLabel.style.top = "-22px";
      selectTag.classList.remove("gray_color")
    }
  })
  const inputFields = document.querySelectorAll(".contact_input_fields");
  inputFields.forEach(input=>{
    input.addEventListener("change",(e)=>{
      const value = e.target.value;
      const errorBox = document.getElementById(e.target.name);
      switch (e.target.id) {
      case 'ContactForm-name':
        if(e.target.value.length < 3){
          errorBox.innerText = "Name must be 3 character long"
        }else{
          errorBox.innerText = "";
        }
        break;
      case 'ContactForm-email':
        if(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e.target.value)){
          errorBox.innerText = "";
        }else{
          errorBox.innerText = "Invalid email address.";
        }
        break;
      case 'ContactForm-phone':
        if(/(\+\d{1,3}\s?)?((\(\d{3}\)\s?)|(\d{3})(\s|-?))(\d{3}(\s|-?))(\d{4})(\s?(([E|e]xt[:|.|]?)|x|X)(\s?\d+))?/g.test(e.target.value)){
          errorBox.innerText = "";
        }else{
          errorBox.innerText = "Invalid Phone Number. Example: 65XXXXXXXX";
        }
        break;
      case 'ContactForm-discover':
        break;
      case 'ContactForm-project_details':
        if(e.target.value.length < 10){
          errorBox.innerText = "Text must be 10 character long"
        }else{
          errorBox.innerText = "";
        }
        break;
      case 'ContactForm-body':
        if(e.target.value.length < 10){
          errorBox.innerText = "Text must be 10 character long"
        }else{
          errorBox.innerText = "";
        }
        break;
      }
    })
  })
</script>
<script>
  const selectTag2 = document.getElementById("ContactForm-project");
  const selectLabel2 = document.querySelector(".option_project");
  selectTag2.addEventListener("click",(e)=>{
    if(e.target.value){
      selectLabel2.style.fontSize = "10px";
      selectLabel2.style.top = "-22px";
      selectTag2.classList.remove("gray_color")
    }
  })
</script>
{% schema %}
{
   "name": "footer contact",
  "class": "footer-contact section",
 "settings": [
     {
       "type": "text",
       "id": "title",
       "label": "Title"
     },
     {
       "type": "textarea",
       "id": "heading",
       "label": "Heading"
     },
     {
        "type": "text",
        "id": "btn_text",
        "label": "Button Text"
     },
		 {
			"type": "select",
			"id": "btn_type",
			"label": "Button Type",
			"options": [
				{
					"value": "primary",
					"label": "Primary"
				},
				{
					"value": "secondary",
					"label": "Secondary"
				}
			],
			"default": "primary"
		  },
		 {
			"type": "select",
			"id": "page_name",
			"label": "Form Template",
			"options": [
				{
					"value": "home",
					"label": "Home"
				},
				{
					"value": "new_home",
					"label": "New home"
				},
				{
					"value": "group_buy",
					"label": "Group buy"
				}
			],
			"default": "home"
		  }
 ],
  "blocks": [
      {
        "name": "Project Options",
        "type": "project_block",
        "settings": [
            {
              "type": "text",
              "id": "projectname",
              "label": "Title"
            }
        ]
      }
  ],
  "presets": [
    {
        "name":"Footer Contact"
    }
  ]
}
{% endschema %}
