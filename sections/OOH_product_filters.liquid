{% assign iteration = 0 %}
{% assign selected_vibe = '' %}

{{ 'paint-details-slider.css' | asset_url | stylesheet_tag }}

<style>

  /* ===============================================
  // Reveal module
  // =============================================== */

  .reveal .hidden {
    display: block !important;
    visibility: visible !important;
  }

  .product:hover .reveal img {
    opacity: 1;
  }

  .reveal {
    position: relative;
  }

  .reveal .hidden {
    position: absolute;
    z-index: -1;
    top: 10px;
    left: 43px;
    width: 34%;
    height: 69%;
    opacity: 0;
    -webkit-transition: opacity 0.3s ease-in-out;
    -moz-transition: opacity 0.3s ease-in-out;
    -o-transition: opacity 0.3s ease-in-out;
    transition: opacity 0.3s ease-in-out;
  }

  .reveal:hover .hidden {
    z-index: 0;
    opacity: 1;
  }

  .reveal .caption {
    position: absolute;
    top: 0;
    display: table;
    width: 100%;
    height: 100%;
    background-color: white;
    /* fallback for IE8 */
    background-color: rgba(255, 255, 255, 0.7);
    font: 13px/1.6 sans-serif;
    text-transform: uppercase;
    color: #333;
    letter-spacing: 1px;
    text-align: center;
    text-rendering: optimizeLegibility;
  }

  .reveal .hidden .caption .centered {
    display: table-cell;
    vertical-align: middle;
  }
  @media (min-width: 480px) and (max-width: 979px) {
    .reveal .caption {
      font-size: 11px;
    }
  }
</style>
<style>
    .collection_button {
      border-radius: 1px;
  border: 1px solid var(--Secondary-6, #302112);
      display: inline-flex;
  padding: 20px;
  justify-content: center;
  align-items: center;
  gap: 20px;
    }
</style>
<ooh-campaign-component>
<form id="vibe-selection">

  <!-- Vibe Selection Carausel will come here -->
  
<!-- OOH product filters starts from here -->

<div id="ooh_product_filter_section">
  <div class="filtered_product_section">
    <h2 class="gush-font-h1" style="font-size:42px">Take your pick.</h2>
    <h3 style="font-size:16px;">These pocket-sized 20ml paint samples are the best way to experience colours in person.</h3>

<div class="filter_drop_down">
          <div class="collection-filter">
         <label>Showing {{ collection.title }} vibe pallet</label>
          <select id="collection-filter-select">
            {% for collection in collections %}
            {% if collection.handle contains 'vibe' %}
            {% assign iteration = iteration | plus: 1 %}
            {% if iteration == 1 %}
            {% assign selected_vibe = collection.handle %}
            {% endif %}
             
           <option value="{{ collection.handle }}" {% if iteration==1 %} selected {% endif %}>
            {{ collection.title }}
            </option>

            
            
            {% endif %}
            {% endfor %}
          </select>
        </div>
</div>

  <div id="products_3_grid_slick">
    {% assign collection = collections['vibe-1'] %}
    <div class="vibe-1 {% unless collection.handle == selected_vibe %}hidden{% endunless %} ooh_filtered_products"
      data-vibe="{{ collection.handle }}">
      {%- for product in collection.products -%}
        {%- liquid
          assign current_variant = blank
    
          for variant in product.variants
            if variant.option1 == 'Gush Cair' and variant.option2 == 'Paint Sample (20ml)'
              assign current_variant = variant
            endif
          endfor
        -%}
        
      {% if current_variant != blank %}
      <div class="product-item">
        <label class="custom-checkbox">
        <input type="checkbox" id="vibe_1_{{ product.title }}" class="vibe_input hidden-checkbox name="vibe" value="{{ current_variant.id }}" data-title="{{ product.title }}">
     <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26" fill="none">
  <rect width="25.4386" height="25.4386" rx="12.7193" fill="#FF42EF"/>
  <circle cx="13.5049" cy="15.295" r="0.628444" transform="rotate(45 13.5049 15.295)" fill="#302112"/>
  <circle cx="11.7271" cy="17.0743" r="0.628444" transform="rotate(45 11.7271 17.0743)" fill="#302112"/>
  <circle cx="9.94971" cy="18.8487" r="0.628444" transform="rotate(45 9.94971 18.8487)" fill="#302112"/>
  <circle cx="15.2822" cy="13.5177" r="0.628444" transform="rotate(45 15.2822 13.5177)" fill="#302112"/>
  <circle cx="17.0596" cy="11.7413" r="0.628444" transform="rotate(45 17.0596 11.7413)" fill="#302112"/>
  <circle cx="8.01953" cy="16.7257" r="0.628444" transform="rotate(45 8.01953 16.7257)" fill="#302112"/>
  <circle cx="6.2417" cy="14.9473" r="0.628444" transform="rotate(45 6.2417 14.9473)" fill="#302112"/>
  <circle cx="18.811" cy="9.92" r="0.628444" transform="rotate(45 18.811 9.92)" fill="#302112"/>
</svg>
  Checkbox Label Text
</label>
        
        <label for="vibe_1_{{ product.title }}">
          <div class="reveal">
            {% for image in product.images limit: 1 offset: 1 %}
            <img class="grid-view-item__image" src="{{ image | img_url:" 200x200" }}">
            {% endfor %}
  
            <img class="hidden" src="{{ 'paint_pack_sacket.png' | asset_url }}">
          </div>
        </label>
  {% assign productTitle = product.title | split: "/" %}
        <h4 class="filtered_product_title">{{ product.title }}</h4>
     <h5 class="filtered_varient_title">{{ current_variant.title | replace: "Gush Cair / ", "" }}</h5>
        <!-- Add code to display product image, price, etc. -->
      </div>
      {% endif %}
      {%- endfor -%}
    </div>

    {% assign collection = collections['vibe-2'] %}
    <div class="vibe-2 {% unless collection.handle == selected_vibe %}hidden{% endunless %} ooh_filtered_products"
      data-vibe="{{ collection.handle }}">
      {%- for product in collection.products -%}
      {%- liquid
      assign current_variant = blank

      for variant in product.variants
      if variant.option1 == 'Gush Cair' and variant.option2 == 'Paint Sample (20ml)'
      assign current_variant = variant
      endif
      endfor
      -%}
      {% if current_variant != blank %}
      <div class="product-item">
        <input type="checkbox" id="vibe_2_{{ product.title }}" class="vibe_input" name="vibe" value="{{ current_variant.id }}" data-title="{{ product.title }}">
        <label for="vibe_2_{{ product.title }}">
          <div class="reveal">
            {% for image in product.images limit: 1 offset: 1 %}
            <img class="grid-view-item__image" src="{{ image | img_url:" 200x200" }}">
            {% endfor %}
  
            <img class="hidden" src="{{ 'paint_pack_sacket.png' | asset_url }}">
          </div>
        </label>
        <h4 class="filtered_product_title">{{ product.title }}</h4>
        <h5 class="filtered_varient_title">{{ current_variant.title | replace: "Gush Cair / ", "" }}</h5>
        <!-- Add code to display product image, price, etc. -->
      </div>
      {% endif %}
      {%- endfor -%}
    </div>

    {% assign collection = collections['vibe-3'] %}
    <div class="vibe-3 {% unless collection.handle == selected_vibe %}hidden{% endunless %} ooh_filtered_products"
      data-vibe="{{ collection.handle }}">
      {%- for product in collection.products -%}
      {%- liquid
      assign current_variant = blank

      for variant in product.variants
      if variant.option1 == 'Gush Cair' and variant.option2 == 'Paint Sample (20ml)'
      assign current_variant = variant
      endif
      endfor
      -%}
      {% if current_variant != blank %}
      <div class="product-item">
        <input type="checkbox" id="vibe_3_{{ product.title }}" class="vibe_input" name="vibe" value="{{ current_variant.id }}" data-title="{{ product.title }}">
        <label for="vibe_3_{{ product.title }}">
          <div class="reveal">
            {% for image in product.images limit: 1 offset: 1 %}
            <img class="grid-view-item__image" src="{{ image | img_url:" 200x200" }}">
            {% endfor %}
  
            <img class="hidden" src="{{ 'paint_pack_sacket.png' | asset_url }}">
          </div>
        </label>

         <h4 class="filtered_product_title">{{ product.title }}</h4>
        <h5 class="filtered_varient_title">{{ current_variant.title | replace: "Gush Cair / ", "" }}</h5>
      
        <!-- Add code to display product image, price, etc. -->
      </div>
      {% endif %}
      {%- endfor -%}
    </div>

      <div class="btn-wrap">
	<button class="prev-btn">Previous</button>
	<button class="next-btn">Next</button>
</div>
  </div>
    
  </div>
</div>


  <!-- OOH Whats include in package starts from here -->

<div id="ooh_package_you_get_section">
  <h3 class="gush-ooh_main_heading">Your bundle includes:</h3>
  <h4 class="gush_ooh_sub_heading">3 Paint samples, Paint sponges, Paint palettes and Swatch cards</h4>
  <div class="ooh_package_banner"><p></p></div>
</div> 


  <div class="survey_plus_order"> 
       <div class="ooh_survey_container">
<!-- OOH survey starts from here -->
<div id="ooh_survey_section">

    <div class="question1_class">
         <h3 class="survey_question">What are you painting ?</h3>
        <label><input type="radio" name="question1" value="One Room">One Room</label>
        <label><input type="radio" name="question1" value="Multiple Room">Multiple Room</label>
    </div>
      <div class="question2_class">
       <h3 class="survey_question">How soon do you want to start painting ?</h3>
       <label><input type="radio" name="question2" value="Within 1-4 Weeks">Within 1-4 Weeks</label>
       <label><input type="radio" name="question2" value="Within 1-3 Months">Within 1-3 Months</label>
       <label><input type="radio" name="question2" value="More then 3 Months">More then 3 Months</label>
      </div>
  <!-- Add more radio buttons as needed --><br>
  
</div>

<!-- OOH Order Deatils starts from here -->
  <div id="OOH_order_details_section">
  <h2 class="gush-font-h1" style="font-size:42px">Order Details</h2>



    <div class="order_details_data_row">
  <div class="order_details_data_column_color">
    <p>Column 1</p>
    <p>Some text..</p>
  </div>
  <div class="order_details_data_column2">
    <p style="font-size:16px">Paint Samples <span class="order_column2_span1">x3</span><span class="order_column2_span2">$0</span></p>
    <div id="selected_colors">color: <span class="colors"></span></div>
     <div>Size: <span>Paint Pack (20 ml)</span></div>
  </div>
</div>
</div>



<!-- OOH Order Deatils starts from here -->
<div class=shipping_details_tnC>
  <p>Shipping fee</p>
  <div class="shipping_charge">
    <p>
      <span style=" text-decoration: line-through;">$3.29 SGD</span> Free shipping
    </p>
  </div>
  <div class="left_right_container">
    <div class="left">Total</div>
    <div class="right">Free</div>
  </div>
  <p class="ooh_terms_condition">Your personal data will be used to process your order, support your experience throughout this website, and for
    other purposes described in our Privacy policy </p>
<input type="checkbox" id="tnc" name="gush TnC" value="I have read and agree to the gush.earth"><p>I have read and agree to the gush.earth <a>terms and conditions</a></p>
</div>

          <button type="submit" class="checkout_button">Place Order <img src="https://cdn.shopify.com/s/files/1/0614/1470/3297/files/Group_2223.svg?v=1696707059"></button>
      
       <div class="congratulations_message_free_ship">
      <img src="https://cdn.shopify.com/s/files/1/0614/1470/3297/files/Group_3.svg?v=1696707356">Nice -- you've got free shipping.
  </div>
         <img class="footer_banner" src="https://cdn.shopify.com/s/files/1/0614/1470/3297/files/08_2.png?v=1696707672">
       </div>
    </div>

  
</form>
</ooh-campaign-component>
<script>
  class OOHCampaignComponent extends HTMLElement {
    constructor() {
      super()
      
      this.form = this.querySelector('#vibe-selection')
      this.filter = this.form.querySelector('select#collection-filter-select')
      
      this.selectedColors = []
      this.colorInfoEl = this.querySelector('#selected_colors span')

      this.selectedVariants = []
      
      this.q1 = ""
      this.q2 = ""
    }

    connectedCallback() {
      this.form.addEventListener('change', this.handleChange.bind(this))
      this.filter.addEventListener('change', this.handleFilterChange.bind(this))
      this.form.addEventListener('submit', this.handleSubmit.bind(this))

      fetch("/cart.js", { method: 'GET', headers: { "Content-Type": "application/json" }})
      .then(res => res.json())
      .then(data => {
        this.cart = data

        this.cart.items.forEach(item => {
          if(item.properties.ooh_item) this.removable[item.id] = 0
        })

        fetch("/cart/update.js", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            updates: this.removable
          })
        })
      })
    }

    handleSubmit(e) {
      e.preventDefault()

      const note = `
        What are you painting: ${this.q1}.
        How soon do you want to start painting: ${this.q2}
      `
      
      const data = {
        items: [],
        note: note
      }

      this.selectedVariants.forEach(variantId => {
        data.items.push({
          id: variantId,
          quantity: 1
        })
      })

      const options = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data)
      };

      fetch("/cart/add.js", options)
      .then(res => res.json())
      .then(data => {
        console.log(data)
        window.location.href = '/checkout?discount=CAMPAIGN100'
      })
      .catch(err => console.log(err))
    }

    handleFilterChange(e) {
      e.preventDefault()
      const el = e.currentTarget

      const collections = this.querySelectorAll('[data-vibe]')
      const vibe = el.value

      collections.forEach(item => {
        const _vibe = item.dataset.vibe
        if (vibe === _vibe) {
          if (item.classList.contains('hidden')) item.classList.remove('hidden')
        }
        else {
          if (!item.classList.contains('hidden')) item.classList.add('hidden')
        }
      })
    }

    handleChange(e) {
      const el = e.target
      const formData = new FormData(this.form)
      if(el.getAttribute('name') == 'vibe') {
        
        const value = el.dataset.title
        const vibes = []
        
        if(el.checked) {
          if(!this.selectedColors.includes(value)) this.selectedColors.push(value)
        }
        else {
          const newArray = this.selectedColors.filter(item => item !== value);
          this.selectedColors = newArray
        }

        formData.getAll('vibe').forEach(vibe => {
          vibes.push(parseInt(vibe))
        })
        this.selectedVariants = vibes

        this.disabledVibeSelection(3, this.selectedVariants.length)
        

        this.colorInfoEl.innerHTML = this.selectedColors.join(', ')
        console.log(this.selectedVariants)
      }

      if(el.getAttribute('name') == 'question1') {
        this.q1 = el.value
      }

      if(el.getAttribute('name') == 'question2') {
        this.q2 = el.value
      }
    }

    disabledVibeSelection(max, current) {
      const vibesInput = this.querySelectorAll(`.vibe_input`)
      if(max == current) {
        vibesInput.forEach(item => {
          if(!item.checked) item.disabled = true
        })
      }
      else {
        vibesInput.forEach(item => {
          item.disabled = false
        })
      }
    }
  }
  customElements.define('ooh-campaign-component', OOHCampaignComponent)
</script>

  
{% schema %}
 {
    "name":"OOH Filter Products",
    "settings":[
        {
            "type":"text",
            "id":"heading",
            "label":"Heading"
        }
    ],
    "blocks":[
        {
            "type":"slide",
            "name":"Slide",
            "settings":[
                {
                    "type":"image_picker",
                    "id":"img",
                    "label":"Image"
                },
              {
"id" : "vibe_collection",
"type" : "collection",
"label" : "collection"
}
            ]
        }
    ],
    "presets":[
        {
            "name":"OOH Filter Products"
        }
    ]
}
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
